<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🎮 Rivals Duo Tournament Signup</title>
  <style>
    /* Reset & base */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 20px;
      background: linear-gradient(135deg, #181823, #2b2a45);
      color: #f0f0f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    .container {
      max-width: 650px;
      margin: auto;
      background: #282843;
      padding: 30px 25px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3), inset 0 0 10px #40406e;
    }
    h1 {
      color: #ffd43b;
      text-align: center;
      margin-bottom: 15px;
      font-weight: 700;
      font-size: 2rem;
      text-shadow: 0 0 8px #ffd43b88;
    }
    .rules-box {
      background: linear-gradient(135deg, #29294a, #1a1a2e);
      border: 2px solid #ffd43b;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 25px;
      box-shadow: 0 0 20px #ffd43b80, inset 0 0 10px #333;
      animation: pulse-glow 1.5s infinite alternate;
    }
    @keyframes pulse-glow {
      from { box-shadow: 0 0 10px #ffd43b80, inset 0 0 5px #333; }
      to { box-shadow: 0 0 20px #ffd43bcc, inset 0 0 15px #444; }
    }
    .rules-box label {
      display: block;
      margin-bottom: 12px;
      font-size: 0.95rem;
      cursor: pointer;
    }
    .rules-box input[type="checkbox"] {
      margin-right: 10px;
      transform: scale(1.2);
      vertical-align: middle;
    }
    #acceptBtn {
      width: 100%;
      background: #393962;
      border: none;
      padding: 12px;
      color: #ccc;
      font-weight: 600;
      font-size: 1rem;
      border-radius: 10px;
      cursor: not-allowed;
      opacity: 0.5;
      transition: 0.3s;
      margin-bottom: 20px;
    }
    #acceptBtn.enabled {
      cursor: pointer;
      opacity: 1;
      background: #ffd43b;
      color: #282843;
      box-shadow: 0 0 12px #ffd43baa;
    }
    label {
      margin-top: 18px;
      font-weight: 600;
      font-size: 1rem;
      color: #ddd;
      display: block;
    }
    input[type="text"],
    select {
      width: 100%;
      padding: 12px;
      margin-top: 8px;
      border-radius: 8px;
      border: none;
      background: #3a3a6f;
      color: #eee;
      font-size: 1rem;
    }
    input[type="submit"] {
      margin-top: 30px;
      width: 100%;
      background: #ffd43b;
      border: none;
      padding: 15px;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1.1rem;
      color: #282843;
      cursor: pointer;
      transition: 0.3s;
    }
    input[type="submit"]:hover {
      background: #f9d900;
      box-shadow: 0 0 12px #f9d900aa;
    }
    .honeypot {
      display: none !important;
    }
    #message {
      padding: 12px 20px;
      border-radius: 8px;
      display: none;
      font-size: 1rem;
      font-weight: 600;
      margin-top: 20px;
      text-align: center;
    }
    #message.success {
      background-color: #d4edda;
      color: #1a3b23;
      border: 1px solid #9cd1a6;
    }
    #message.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    hr {
      margin: 30px 0;
      border-color: #444;
    }
    @media (max-width: 600px) {
      .container { padding: 20px 15px; }
      h1 { font-size: 1.6rem; }
      input, select, button { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>🎮 Rivals Duo Tournament</h1>
    
    <div style="text-align: center; margin-bottom: 20px;">
      <a href="brackets" style="color: #ffd43b; text-decoration: none; font-weight: 600; padding: 8px 16px; border: 1px solid #ffd43b; border-radius: 8px; transition: 0.3s;" onmouseover="this.style.background='#ffd43b'; this.style.color='#282843';" onmouseout="this.style.background='transparent'; this.style.color='#ffd43b';">
        🏆 View Current Brackets
      </a>
    </div>

    <div class="rules-box" id="rulesBox">
      <h3 style="color:#ffd43b;">⚠️ Rules (Must Read & Agree)</h3>
      <form id="rulesChecklist">
        <label><input type="checkbox" class="rule-check" /> ✔️ Both players must be the same rank.</label>
        <label><input type="checkbox" class="rule-check" /> 🎯 No solo signups — you must enter with a duo.</label>
        <label><input type="checkbox" class="rule-check" /> 🚫 No cheating, macros, or exploiting.</label>
        <label><input type="checkbox" class="rule-check" /> 🧠 No alt accounts or smurfing — play on your main.</label>
        <label><input type="checkbox" class="rule-check" /> 🎁 Each rank has its own bracket & prize.</label>
        <label><input type="checkbox" class="rule-check" /> 💬 Must stay in the Discord during the event.</label>
      </form>
    </div>

    <button id="acceptBtn" disabled>📜 I’ve Read the Rules</button>

    <form id="signupForm">
      <input type="text" name="extra_field" class="honeypot" autocomplete="off" />

      <label for="discord">💬 Your Discord Username</label>
      <input type="text" id="discord" name="discord" required />

      <label for="roblox">🧑 Your Roblox Username</label>
      <input type="text" id="roblox" name="roblox" required />

      <label for="rank">🏅 Your Rivals Rank</label>
      <select id="rank" name="rank" required>
        <option value="">-- Select Your Rank --</option>
        <option>Bronze</option><option>Silver</option><option>Gold</option>
        <option>Platinum</option><option>Diamond</option><option>Onyx</option>
        <option>Nemesis</option><option>Archnemesis</option>
      </select>

      <hr />

      <label for="duo_discord">👥 Duo's Discord Username</label>
      <input type="text" id="duo_discord" name="duo_discord" required />

      <label for="duo_roblox">🎮 Duo's Roblox Username</label>
      <input type="text" id="duo_roblox" name="duo_roblox" required />

      <label for="duo_rank">🏅 Duo's Rivals Rank</label>
      <select id="duo_rank" name="duo_rank" required>
        <option value="">-- Select Their Rank --</option>
        <option>Bronze</option><option>Silver</option><option>Gold</option>
        <option>Platinum</option><option>Diamond</option><option>Onyx</option>
        <option>Nemesis</option><option>Archnemesis</option>
      </select>

      <input type="submit" value="🚀 Sign Up!" />
    </form>

    <div id="message"></div>
  </div>

  <script>
    const acceptBtn = document.getElementById("acceptBtn");
    const checkboxes = document.querySelectorAll(".rule-check");
    const signupForm = document.getElementById("signupForm");

    function showMessage(text, type = "success") {
      const msgBox = document.getElementById("message");
      msgBox.textContent = text;
      msgBox.className = type === "error" ? "error" : "success";
      msgBox.style.display = "block";

      setTimeout(() => {
        msgBox.style.display = "none";
        msgBox.textContent = "";
      }, 7000);
    }

    // Rule checkboxes enable accept button when all checked
    checkboxes.forEach(cb => {
      cb.addEventListener("change", () => {
        const allChecked = [...checkboxes].every(box => box.checked);
        acceptBtn.disabled = !allChecked;
        if (allChecked) {
          acceptBtn.classList.add("enabled");
          acceptBtn.style.cursor = "pointer";
        } else {
          acceptBtn.classList.remove("enabled");
          acceptBtn.style.cursor = "not-allowed";
        }
      });
    });

    // After accepting rules, enable form inputs & disable accept button
    acceptBtn.addEventListener("click", () => {
      if (acceptBtn.disabled) return;
      acceptBtn.textContent = "✅ Rules Acknowledged";
      acceptBtn.disabled = true;
      acceptBtn.classList.remove("enabled");
      acceptBtn.style.cursor = "not-allowed";
      signupForm.querySelectorAll("input, select").forEach(el => {
        if (!el.classList.contains("honeypot")) el.disabled = false;
      });
      // Disable rules checkboxes
      checkboxes.forEach(cb => cb.disabled = true);
      // Stop glowing animation on rules box
      document.getElementById("rulesBox").style.animation = "none";
    });

    // Initially disable form inputs except honeypot
    window.addEventListener("DOMContentLoaded", () => {
      signupForm.querySelectorAll("input, select").forEach(el => {
        if (!el.classList.contains("honeypot")) el.disabled = true;
      });
    });

    signupForm.addEventListener("submit", async (e) => {
      e.preventDefault();

      if (signupForm.querySelector('input[name="extra_field"]').value !== "") return;

      const formData = {
        discord: document.getElementById("discord").value.trim(),
        roblox: document.getElementById("roblox").value.trim(),
        rank: document.getElementById("rank").value,
        duo_discord: document.getElementById("duo_discord").value.trim(),
        duo_roblox: document.getElementById("duo_roblox").value.trim(),
        duo_rank: document.getElementById("duo_rank").value,
        extra_field: "" // honeypot
      };

      if (formData.rank !== formData.duo_rank) {
        showMessage("❌ Both players must have the SAME rank!", "error");
        return;
      }

      try {
        const res = await fetch("/api/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(formData)
        });
        const result = await res.json();

        if (res.ok && result.success) {
          showMessage(`✅ You're signed up! Your Bracket ID: ${result.bracketId}`);
          signupForm.reset();
          // Disable form inputs again until rules accepted (optional)
          signupForm.querySelectorAll("input, select").forEach(el => {
            if (!el.classList.contains("honeypot")) el.disabled = true;
          });
          acceptBtn.textContent = "📜 I’ve Read the Rules";
          acceptBtn.disabled = true;
          acceptBtn.style.cursor = "not-allowed";
          checkboxes.forEach(cb => {
            cb.checked = false;
            cb.disabled = false;
          });
          document.getElementById("rulesBox").style.animation = "pulse-glow 1.5s infinite alternate";
        } else {
          showMessage(`⚠️ Error: ${result.error || "Unknown error"}`, "error");
        }
      } catch (err) {
        showMessage("❌ Could not connect to server.", "error");
        console.error(err);
      }
    });
  </script>
</body>
</html>
